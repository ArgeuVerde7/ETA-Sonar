<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
    <script type="module" src="../out-tsc/src/index.js"></script>
    <script type="module" src="../out-tsc/demo/demoview/demoview.js"></script>
    <title>Exemplo</title>
  </head>

  <body>
    <demo-view></demo-view>
    <script type="text/javascript">
      /* eslint-disable no-undef */
      /* eslint-disable @typescript-eslint/explicit-function-return-type */
      /* eslint-disable no-undef */
      // HACK(keanulee): The Redux package assumes `process` exists - mock it here before
      // the module is loaded.
      window.process = {
        env: {
          NODE_ENV: 'production',
        },
      };
    </script>
<<<<<<< HEAD
=======

    <script type="module">
      /* eslint-disable no-undef */
      /* eslint-disable @typescript-eslint/explicit-function-return-type */
      import { html, LitElement } from 'lit-element';
      import { render } from 'lit-html';

      import '../out-tsc/src/index.js';
      import { MPV_ALTERACAO } from '../out-tsc/demo/doc/mpv_alteracao.js';
      import { MPV_SIMPLES } from '../out-tsc/demo/doc/mpv_simples.js';
      import { MPV_930_2020 } from '../out-tsc/demo/doc/mpv_930_2020.js';
      import { COD_CIVIL_COMPLETO } from '../out-tsc/demo/doc/codigocivil_completo.js';
      import { COD_CIVIL_PARCIAL1 } from '../out-tsc/demo/doc/codigocivil_parcial1.js';
      import { COD_CIVIL_PARCIAL2 } from '../out-tsc/demo/doc/codigocivil_parcial2.js';
      import { PLC_ARTIGOS_AGRUPADOS } from '../out-tsc/demo/doc/plc_artigos_agrupados.js';
      import { EMENDA_MPV_00930_2020 } from '../out-tsc/demo/doc/emenda_exemplo_mpv_00930_2020.js';

      const mapProjetosNormas = {
        novo: {},
        mpv_alteracao: MPV_ALTERACAO,
        mpv_simples: MPV_SIMPLES,
        mpv_930_2020: MPV_930_2020,
        codcivil_completo: COD_CIVIL_COMPLETO,
        codcivil_parcial1: COD_CIVIL_PARCIAL1,
        codcivil_parcial2: COD_CIVIL_PARCIAL2,
        plc_artigos_agrupados: PLC_ARTIGOS_AGRUPADOS,
      };

      const mapEmendas = {
        mpv_930_2020: EMENDA_MPV_00930_2020,
      };

      class DemoView extends LitElement {
        static get properties() {
          return {
            projetoNorma: { type: String },
            modo: { type: String },
          };
        }

        createRenderRoot() {
          return this;
        }

        constructor() {
          super();
          this.projetoNorma = '';
          this.modo = '';
          this.emenda = {};
          this.arquivoProjetoNorma = {};
        }

        onChangeDocumento() {
          const elmDocumento = this.querySelector('#projetoNorma');
          let elmAcao = this.querySelector('#modo');
          if (elmDocumento.value === 'novo') {
            this.querySelector('#emenda').disabled = this.querySelector('#emendaArtigoOndeCouber').disabled = true;
            this.querySelector('#edicao').selected = true;
          } else {
            this.querySelector('#emenda').disabled = this.querySelector('#emendaArtigoOndeCouber').disabled = false;
          }
        }

        executar() {
          const elmAcao = this.querySelector('#modo');
          const elmDocumento = this.querySelector('#projetoNorma');
          this.querySelector('lexml-emenda-comando').emenda = {};
          document.getElementById('fileUpload').value = "";

          if (elmDocumento && elmAcao) {
            setTimeout(() => {
              this.modo = elmAcao.value;
              this.projetoNorma = elmDocumento.value;
              this.emenda = {};
              this.arquivoProjetoNorma = {};
            }, 0);
          }
        }

        onChange(e) {
          console.log('EVENTO', e.detail.origemEvento || '*', e.detail);

          if (this.modo.startsWith('emenda')) {
            const emenda = this.querySelector('lexml-eta').getComandoEmenda();
            this.querySelector('lexml-emenda-comando').emenda = emenda;

            console.log('Emenda ---------------------');
            console.log(this.querySelector('lexml-eta').getEmenda());
          }
        }

        salvar() {
          const projetoNorma = mapProjetosNormas[this.projetoNorma]
          const emenda = this.querySelector('lexml-eta').getEmenda();
          const emendaJson = JSON.stringify({
            'projetoNorma': projetoNorma,
            'emenda': emenda
          });
          const blob = new Blob([
            emendaJson
          ], {
            type: 'application/json'
          });
          const fileName = `${this.projetoNorma}.json`;
          const objectUrl = URL.createObjectURL(blob);
          const a = document.createElement('a');

          a.href = objectUrl;
          a.download = fileName;
          document.body.appendChild(a);
          a.click();
        }

        abrir() {
          let fileUpload = document.getElementById('fileUpload');
          if (fileUpload != null) {
            fileUpload.click();
          }
        }

        selecionaArquivo(event) {
          const fileInput = event.target;
          if (fileInput && fileInput.files) {
            var fReader = new FileReader();
            fReader.readAsText(fileInput.files[0]);
            fReader.onloadend = (e) => {
              if (e.target.result) {
                const result = JSON.parse(e.target.result);
                this.modo = result.emenda.classificacao;
                this.arquivoProjetoNorma = result.projetoNorma;
                this.emenda = result.emenda;
              }
            };
          }
        }

        render() {
          return html`
              <style>
                .lexml-eta-main-header {
                  display: flex;
                  justify-content: space-between;
                  padding: 1rem 0;
                  flex-wrap: wrap;
                }
                .lexml-eta-main-header--selecao select,
                .lexml-eta-main-header--selecao button {
                  height: 1.5rem;
                }
                .lexml-eta-main-header span {
                  vertical-align: middle;
                  font-family: sans-serif;
                  font-size: 1.2rem;
                  font-weight: bold;
                }
                .lexml-eta-btn--demo {
                  text-align: center;
                  color: white;
                  border-radius: 8px;
                  background: red;
                  width: 4rem;
                  height: 1.5rem;
                }

                lexml-eta {
                  display: block;
                  height: calc(100vh - 80px);
                  outline: 0;
                  border: 0;
                  -webkit-box-shadow: 0px;
                  box-shadow: none;
                }
                .wrapper {
                  display: grid;
                  grid-template-columns: ${this.modo.startsWith('emenda') ? '2fr 1fr' : '1fr 0'};
                }
                #comandoEmenda {
                  display: ${this.modo.startsWith('emenda') ? 'block' : 'none'};
                }
              </style>
              <div class="lexml-eta-main-header">
                <div class="lexml-eta-main-header--title">
                  <span>ETA - Editor de Textos Articulados </span>
                  <input type="button" class="lexml-eta-btn--demo" title="Aplicação exemplo" value="Demo"></input>
                </div>
                <div class="lexml-eta-main-header--actions">
                  <input type="button" value="Salvar" @click=${this.salvar}></input>
                  <input type="button" value="Abrir" @click=${this.abrir}></input>
                  <input
                      type="file"
                      id="fileUpload"
                      accept="application/json"
                      @change="${this.selecionaArquivo}"
                      style="display: none"
                  />
                </div>
                <div class="lexml-eta-main-header--selecao">
                  <select id="projetoNorma" @change=${this.onChangeDocumento}>
                    <option value="novo">Nova articulação</option>
                    <option value="mpv_alteracao">MP 885, de 2019</option>
                    <option value="mpv_simples" selected>MP 905, de 2019</option>
                    <option value="mpv_930_2020">MP 930, de 2020</option>
                    <option value="codcivil_completo">Código Civil Completo</option>
                    <option value="codcivil_parcial1">Código Civil (arts. 1 a 1023)</option>
                    <option value="codcivil_parcial2">Código Civil (arts. 1 a 388)</option>
                    <option value="plc_artigos_agrupados">PLC Artigos Agrupados</option>
                  </select>
                  <select id="modo">
                    <option value="edicao" id="edicao">Edição</option>
                    <option value="emenda" id="emenda" selected>Emenda</option>
                    <option value="emendaArtigoOndeCouber" id="emendaArtigoOndeCouber">Emenda: propor artigo onde couber</option>

                  </select>
                  <input type="button" value="Ok" @click=${this.executar}></input>
                </div>
              </div>
              <div class="wrapper">
                <div>
                  <lexml-eta
                    id="lexmlEta"
                    @onchange=${this.onChange}
                    modo=${this.modo}
                    .projetoNorma=${Object.keys(this.arquivoProjetoNorma).length !== 0 ? this.arquivoProjetoNorma : mapProjetosNormas[this.projetoNorma]}
                    .emenda=${this.projetoNorma === 'mpv_930_2020' ? EMENDA_MPV_00930_2020.emenda : this.emenda}
                  </lexml-eta>
                </div>
                <div id="comandoEmenda">
                  <lexml-emenda-comando></lexml-emenda-comando>
                </div>
              </div>
            `;
        }
      }
      customElements.define('demo-view', DemoView);

      render(html`<demo-view></demo-view>`, document.querySelector('#demo'));
    </script>
>>>>>>> 0455c9c (adiciona botao de abrir emenda e aplica as alterações nos dispositivos)
  </body>
</html>
